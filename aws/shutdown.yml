---
- name: Provision instance in AWS EC2
  hosts: all
  connection: local
  vars:
    access_key: accesskey
    secret_key: secretkey
    subnet: subnet

  tasks:  
  - name: Gather instance facts
    action: ec2_facts

  - name: Stop instances
    ec2:
      aws_access_key: "{{ access_key }}"
      aws_secret_key: "{{ secret_key }}"
      instance_ids: "{{ ansible_ec2_instance_id }}"
      wait: True
      vpc_subnet_id: "{{ subnet }}"
      region: us-east-1
      state: stopped